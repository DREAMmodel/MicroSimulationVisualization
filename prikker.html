<!DOCTYPE html>
<meta charset="utf-8">

<style>
.stepNames { font-family:Arial; font-size:11px;}
body { background-color: #ffffff; }
* { font-family:Arial; font-size:13px; }
input { font-size:11px; }
</style>
<body>

</body>

<script src="d3.v3.min.js"></script>
<script>

var dataset = [
[11,0,	0,	1,	2,	2,	2,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	8,	8,	8,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	11,	11,	11,	11,	11,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	3,	3,	3,	5,	5,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	11,	8,	8,	8,	8,	11,	11,	8,	9,	9,	9,	9,	9,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	2,	2,	2,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	3,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	8,	8,	8,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	6,	6,	6,	9,	9,	9,	10,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	11,	11,	11,	11,	2,	2,	2,	11,	11,	6,	6,	6,	6,	9,	9,	9,	9,	9,	],
[11,0,	0,	1,	3,	3,	3,	11,	6,	6,	6,	6,	9,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	4,	11,	11,	11,	4,	4,	11,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	4,	4,	4,	3,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	3,	3,	3,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	8,	8,	11,	11,	11,	11,	11,	11,	11,	11,	6,	6,	6,	6,	11,	],
[11,0,	0,	0,	4,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	5,	],
[11,0,	0,	0,	1,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	2,	2,	2,	11,	11,	8,	8,	8,	9,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	3,	3,	3,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	2,	2,	2,	11,	11,	11,	11,	11,	11,	11,	11,	6,	6,	6,	6,	9,	9,	9,	11,	],
[11,0,	0,	4,	11,	4,	4,	4,	4,	11,	11,	11,	11,	4,	11,	11,	11,	6,	6,	6,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	11,	8,	8,	8,	9,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	5,	5,	5,	11,	11,	11,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	3,	2,	2,	2,	6,	6,	6,	6,	9,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	11,	11,	11,	11,	2,	2,	2,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	3,	3,	3,	8,	8,	8,	9,	11,	11,	9,	9,	9,	11,	11,	10,	10,	11,	11,	11,	],
[11,0,	0,	0,	4,	11,	2,	2,	2,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	2,	2,	11,	11,	2,	2,	5,	5,	11,	11,	4,	4,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	4,	11,	2,	2,	2,	4,	4,	4,	11,	5,	5,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	11,	11,	11,	6,	6,	6,	6,	6,	6,	4,	6,	8,	8,	8,	8,	],
[11,0,	0,	1,	3,	3,	3,	11,	5,	5,	5,	5,	5,	11,	6,	6,	6,	6,	6,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	11,	11,	11,	11,	11,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	4,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	3,	2,	2,	11,	11,	8,	8,	8,	11,	9,	9,	9,	9,	9,	9,	9,	9,	9,	],
[11,0,	0,	0,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	5,	4,	4,	11,	11,	],
[11,0,	0,	0,	1,	2,	2,	11,	11,	11,	11,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	4,	4,	4,	5,	5,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	11,	11,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	11,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	11,	11,	4,	4,	4,	4,	11,	11,	11,	8,	8,	8,	8,	8,	8,	9,	9,	11,	11,	],
[11,0,	0,	11,	4,	11,	11,	11,	11,	11,	5,	5,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	2,	2,	11,	8,	8,	8,	9,	11,	11,	11,	11,	11,	11,	11,	11,	9,	9,	9,	],
[11,0,	0,	0,	4,	4,	4,	4,	11,	11,	4,	4,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	4,	4,	4,	4,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	11,	2,	2,	2,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	0,	4,	3,	4,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	11,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	11,	11,	11,	6,	6,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	8,	11,	11,	11,	11,	11,	11,	8,	8,	8,	8,	8,	9,	9,	11,	11,	],
[11,0,	0,	2,	2,	2,	8,	8,	8,	9,	9,	9,	9,	9,	11,	11,	10,	10,	10,	10,	11,	11,	11,	],
[11,0,	0,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	4,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	8,	8,	8,	8,	9,	9,	9,	10,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	11,	11,	6,	6,	6,	6,	9,	9,	9,	9,	9,	9,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	8,	8,	8,	8,	8,	8,	8,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	11,	0,	11,	11,	4,	4,	4,	11,	11,	4,	11,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	3,	3,	3,	11,	8,	8,	8,	8,	11,	8,	8,	8,	9,	9,	9,	10,	10,	10,	10,	],
[11,0,	0,	1,	2,	11,	11,	11,	11,	11,	8,	8,	8,	8,	8,	9,	8,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	2,	4,	2,	2,	2,	8,	8,	8,	8,	8,	9,	9,	9,	9,	9,	9,	11,	11,	11,	],
[11,0,	0,	0,	1,	2,	2,	11,	11,	11,	11,	11,	11,	11,	11,	8,	8,	8,	8,	9,	9,	9,	11,	],
[11,0,	0,	0,	1,	2,	2,	2,	6,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	11,	3,	3,	3,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	11,	11,	4,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	2,	2,	2,	11,	11,	11,	11,	11,	11,	11,	4,	5,	5,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	4,	4,	4,	11,	11,	11,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	3,	3,	3,	11,	8,	8,	8,	9,	9,	10,	10,	10,	10,	10,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	4,	11,	11,	11,	11,	11,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	3,	3,	3,	11,	11,	11,	11,	11,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	2,	2,	11,	11,	6,	6,	11,	11,	11,	6,	6,	11,	4,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	11,	2,	2,	11,	11,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	2,	2,	11,	11,	11,	6,	6,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	3,	3,	3,	8,	11,	11,	11,	11,	7,	11,	11,	9,	9,	9,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	1,	11,	2,	2,	2,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	2,	3,	3,	3,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	3,	3,	3,	4,	4,	8,	6,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	11,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	3,	3,	3,	11,	8,	11,	11,	11,	11,	11,	11,	11,	11,	11,	5,	11,	11,	5,	5,	],
[11,0,	0,	0,	3,	3,	3,	11,	6,	6,	6,	6,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	4,	11,	4,	4,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	3,	3,	3,	11,	11,	11,	11,	11,	11,	11,	11,	6,	11,	11,	11,	8,	8,	8,	8,	11,	],
[11,0,	0,	11,	11,	11,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	4,	4,	3,	3,	3,	8,	8,	8,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	0,	4,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	1,	2,	2,	2,	11,	8,	8,	8,	9,	9,	9,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	11,	2,	2,	2,	11,	11,	11,	11,	8,	8,	8,	8,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	4,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	11,	],
[11,0,	0,	4,	4,	11,	11,	11,	4,	11,	11,	11,	11,	11,	11,	4,	4,	4,	4,	4,	11,	11,	11,	],
[11,0,	0,	1,	3,	3,	3,	11,	8,	8,	8,	8,	11,	11,	11,	5,	5,	4,	4,	11,	11,	11,	11,	],
];

var data = dataset;

var stepNames = ['Primary school', '10th grade', 'Secondary school (p)','Secondary school (b)', 'Vocational training', 'Short-cycle', 'Bachelor', 'Medium-cycle', 'University bachelor','Candidate','Ph.d','Labor market'];


var steps = 12;
var x = 0;
var wdth;
var hght;
var padding = 50;
var plane;

var color = d3.scale.category10();


function addDots() {
plane.selectAll("circle")
  .data(data)
  .enter().append("circle")
  .attr("r", 4)
 .attr("fill",function(d,i){return color(Math.floor((Math.random() * 10)));});
}

function makePath(from, to) {
  return "M "+from+" "+(hght-120)+" q "+((to-from)/2)+" "+Math.max(-(hght-120),(from-to)/2)+" "+(to-from)+" 0";
}

var stepInterval;
var paths = [];

function drawPaths() {
for (var i = 0; i < steps-1; i++)
{
  paths[i] = [];
  for (var j = i; j < steps-1; j++)
  {
    paths[i][j] = plane.append("path")
      .attr("d", function() { return makePath(i*stepInterval+padding, j*stepInterval+padding); })
      .attr("class", "line").style("stroke", "#000000" ).attr('opacity',0.2).attr('fill', 'none');
  }

    plane.append("text")
    .attr("x", function(d) { return i*stepInterval+padding-20; })
    .attr("y", function(d) { return (hght-120)+10; })
    .attr("class","stepNames")
    .text(stepNames[i]);

  //create paths to "ikke under uddannelse"
  paths[i][steps-1] = plane.append("path")
        .attr("d", function() { return "M "+(i*stepInterval+padding)+" "+(hght-120)+" l "+((wdth-2*padding)/2-i*stepInterval)+" -"+(hght-130-25); })
      .attr("class", "line").style("stroke", "#000000" ).attr('opacity',0.2).attr('fill', 'none');
}
    plane.append("text")
    .attr("x", function(d) { return (wdth-2*padding)/2+padding-30; })
    .attr("y", function(d) { return 35; })
    .attr("class","stepNames")
    .text(stepNames[steps-1]);
}

function sortDots(loop) {
  for (var i = 0; i < steps; i++)
  {
    plane.selectAll(".a"+i).transition()
      .duration(200)
      .attr("cx", function(d,i) { return Math.floor(i/10)*10-20; })
      .attr("cy", function(d,i) { return (i%10+1)*10+10; });
  }

  if (loop && year < data[0].length)
    setTimeout( function() { next(true); }, 1000);
  else
    setTimeout( function() { d3.selectAll("input[type=button]").attr("disabled", null); }, 210);
}

function slide(y,loop) {
  if (y >= data[0].length)
    return;

  plane.selectAll("circle")
    .attr("class", function(d) { return "a"+d[y]; })
    .transition()
    .duration(900)
    .attrTween("transform", delta(y))
    .call(endall, function() { sortDots(loop); });
}

function delta(y) {
  return function(d, i) {
  var from = d[y-1];
  var to = d[y];
  if (from == to)
    return;

  var path = paths[ Math.min(from,to) ][ Math.max(from,to) ].node();
  var l = path.getTotalLength();
    return function(t) {
      var p;
      if (from > to)
        p = path.getPointAtLength(l - (t * l));
      else
        p = path.getPointAtLength(t * l);
      return "translate(" + p.x + "," + p.y + ")";
    }
  }
}

 function endall(transition, callback) {
    var n = 0;
    transition
        .each(function() { ++n; })
        .each("end", function() { if (!--n) callback.apply(this, arguments); });
  }

var year = 1;
function next(loop)
{
  if (year >= data[0].length)
    return;

  d3.selectAll("input[type=button]").attr("disabled", "disabled");
  slide(year++,loop);
  d3.select("#age").html(year+12);
}

function reset()
{
 year=1;
 next(false);
}

function random()
{
 data = [ dataset[Math.floor((Math.random() * dataset.length))] ]; //select random person
 plane.selectAll("circle").remove();
 addDots();
 plane.selectAll("circle").attr("r", 7); //stor cirkel, når kun en person simuleres
 reset();
}

function simAll()
{
 data = dataset; //full dataset
 plane.selectAll("circle").remove();
 addDots();
 reset();
}

function resize() {
d3.select("svg").remove();

  wdth = window.innerWidth;
  hght = Math.min(600,window.innerHeight-100);
  stepInterval = (wdth-padding*2) / (steps-2);

  plane = d3.select("body").append("svg")
                      .attr("width", wdth)
                      .attr("height", hght).style("border","1px solid black");

  drawPaths();
  addDots();
  setTimeout(reset(), 100);
}
resize();
window.onresize = resize;

</script>

<br /><b><span id='age'>14</span> years-old</b>

<br /><input type='button' onclick="next(false);" value="Simulate 1 year">
<input type='button' onclick="next(true);" value="Simulate 20 years">
<input type='button' onclick="reset();" value="Reset simulation">

<br /><input type='button' onclick="random();" value="Simulate one random person">
<input type='button' onclick="simAll();" value="Simulate 100 random persons">

</html>